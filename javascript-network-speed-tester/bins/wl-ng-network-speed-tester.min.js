(function(){"use strict";var e=angular.module("wl-ng-network-speed-tester",[]);e.service("wlNgNSTTimer",[function(){return{now:function(){return(new Date).getTime()},diff:function(e){return(this.now()-e)/1e3}}}]);e.service("wlNgNSTDataGenerator",[function(){return{generate:function(e){var t=[];for(var n=0;n<e;n++){t.push("")}return t.join()}}}]);e.service("wlNgNSTComparisonManager",[function(){return{comparisons:[{type:"Ethernet",download:10240*1024/8,upload:10240*1024/8},{type:"Cable",download:3072*1024/8,upload:384*1024/8},{type:"T1",download:1581*1024/8,upload:1581*1024/8},{type:"DSL",download:256*1024/8,upload:256*1024/8},{type:"Dialup",download:28*1024/8,upload:28*1024/8}],reset:function(){this.resetDownload();this.resetUpload()},resetDownload:function(){for(var e=0;e<this.comparisons.length;e++){this.comparisons[e].downloadValue=0}},resetUpload:function(){for(var e=0;e<this.comparisons.length;e++){this.comparisons[e].uploadValue=0}},refreshDownload:function(){for(var e=0;e<this.comparisons.length;e++){this.comparisons[e].downloadValue=this.comparisons[e].download}},refreshUpload:function(){for(var e=0;e<this.comparisons.length;e++){this.comparisons[e].uploadValue=this.comparisons[e].upload}}}}]);e.service("wlNgNSTServer",["$http","$q","bins","wlNgNSTTimer",function(e,t,n,r){var i=function(r){var i=t.defer();e.head(n+"/"+r).success(function(e,t,n){var r=n("Server");i.resolve(r)}).error(function(e){i.reject(e)});return i.promise};var s=function(r){var i=t.defer();e.get(n+"/"+r).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)});return i.promise};var o=function(r,i){var s=t.defer();e.post(n+"/"+r,i).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)});return s.promise};return{getServer:function(){return i("ping.html?id="+r.now())},ping:function(){return s("ping.html?id="+r.now())},download:function(){return s("payload.html?id="+r.now())},upload:function(e){return o(this.resourceForPost+"?id="+r.now(),e)},resourceForPost:undefined}}]);e.service("wlNgNSTService",["$q","wlNgNSTTimer","wlNgNSTServer",function(e,t,n){return{ping:function(){var r=e.defer();var i=t.now();n.ping().then(function(){var e=t.diff(i);r.resolve(e)},function(e){r.reject(e)});return r.promise},download:function(){var r=e.defer();var i=t.now();n.download().then(function(e){var n=t.diff(i);var s=e.length;r.resolve({time:n,size:s,speed:s/n})},function(e){r.reject(e)});return r.promise},upload:function(r){var i=function(e){if(e){if(e.indexOf("PHP")!==-1){return"ping.php"}else if(e.indexOf("IIS")!==-1){return"ping.aspx"}}return"ping.html"};var s=function(e){var i=t.now();n.upload(r).then(function(){var n=t.diff(i);var s=r.length;e.resolve({time:n,size:s,speed:s/n})},function(t){e.reject(t)})};var o=function(e){n.getServer().then(function(t){n.resourceForPost=i(t);s(e)},function(){n.resourceForPost="ping.html";s(e)})};var u=e.defer();if(n.resourceForPost==null){o(u)}else{s(u)}return u.promise}}}]);e.filter("wlNgNSTCostConverter",[function(){return function(e,t){switch(t){case"bps":return(e/8).toFixed(2);case"Bps":return e.toFixed(2);case"Kbps":return(e/8*1024).toFixed(2);case"KBps":return(e*1024).toFixed(2);case"Mbps":return(e/8*1024*1024).toFixed(2);case"MBps":return(e*1024*1024).toFixed(2);case"Gbps":return(e/8*1024*1024*1024).toFixed(2);case"GBps":return(e*1024*1024*1024).toFixed(2);default:return e.toFixed(2)}}}]);e.filter("wlNgNSTUnitConverter",[function(){return function(e,t){switch(t){case"bps":return(e*8).toFixed(2);case"Bps":return e.toFixed(2);case"Kbps":return(e*8/1024).toFixed(2);case"KBps":return(e/1024).toFixed(2);case"Mbps":return(e*8/1024/1024).toFixed(2);case"MBps":return(e/1024/1024).toFixed(2);case"Gbps":return(e*8/1024/1024/1024).toFixed(2);case"GBps":return(e/1024/1024/1024).toFixed(2);default:return e.toFixed(2)}}}]);e.service("wlNgNSTPercentConverter",[function(){return function(e,t){return(e*100/t).toFixed(2)}}]);e.directive("wlNgNetworkSpeedTester",["$q","$timeout","bins","wlNgNSTService","wlNgNSTComparisonManager","wlNgNSTDataGenerator","wlNgNSTPercentConverter",function(e,t,n,r,i,s,o){return{replace:true,restrict:"A",templateUrl:n+"/wl-ng-network-speed-tester.html",scope:{autoTrigger:"=?",triggerGo:"=",showRefreshButton:"=?",iterations:"=?",showPing:"=?",showDownload:"=?",showUpload:"=?",showComparison:"=?",speedMeasureUnit:"=?",showCost:"=?",unitCostPerByte:"=?",localeSeconds:"@",localeYou:"@",localePing:"@",localeDownload:"@",localeUpload:"@",localeCost:"@",localeUnitCost:"@",localeTotalCost:"@",localeCurrency:"@",localeBillingPeriod:"@"},controller:["$scope",function(u){var a=function(){u.speedMeasureUnit=u.speedMeasureUnit||"Mbps";u.iterations=u.iterations||10;u.localeSeconds=u.localeSeconds||"seconds";u.localeYou=u.localeYou||"You";u.localePing=u.localePing||"Ping";u.localeDownload=u.localeDownload||"Download";u.localeUpload=u.localeUpload||"Upload";u.localeCost=u.localeCost||"Internet Cost";u.localeUnitCost=u.localeUnitCost||"Unit Price";u.localeTotalCost=u.localeTotalCost||"Total Amount";u.localeCurrency=u.localeCurrency||"$";u.localeBillingPeriod=u.localeBillingPeriod||"month";u.autoTrigger=angular.isDefined(u.autoTrigger)?u.autoTrigger:true;u.showRefreshButton=angular.isDefined(u.showRefreshButton)?u.showRefreshButton:true;u.showPing=angular.isDefined(u.showPing)?u.showPing:true;u.showDownload=angular.isDefined(u.showDownload)?u.showDownload:true;u.showUpload=angular.isDefined(u.showUpload)?u.showUpload:true;u.showCost=angular.isDefined(u.showCost)?u.showCost:true;u.showComparison=angular.isDefined(u.showComparison)?u.showComparison:true;u.unitCostPerByte=angular.isDefined(u.unitCostPerByte)?u.unitCostPerByte:20/1024/1024};a();var f=s.generate(102400);u.comparisons=i.comparisons;i.reset(u.comparisons);u.vm={loaderImg:n+"/working.gif",pingTime:0,pingIteration:0,pingInstantTime:0,downloadSpeed:0,downloadIteration:0,downloadInstantSpeed:0,uploadSpeed:0,uploadIteration:0,uploadInstantSpeed:0};u.$watch("triggerGo",function(){if(u.triggerGo){u.triggerGo=false;u.go()}});u.percent=function(e){return o(e,u.maxSpeed())};u.pingStyle=function(){return{width:o(u.vm.pingIteration,u.iterations)+"%"}};u.downloadStyle=function(){var e=100*(u.vm.downloadActive?u.vm.downloadIteration/u.iterations:u.vm.downloadSpeed/u.maxSpeed());return{width:e+"%"}};u.uploadStyle=function(){var e=100*(u.vm.uploadActive?u.vm.uploadIteration/u.iterations:u.vm.uploadSpeed/u.maxSpeed());return{width:e+"%"}};u.comparisonStyle=function(e){return{width:u.percent(e)+"%"}};u.maxSpeed=function(){var e=0;if(u.showComparison){for(var t=0;t<u.comparisons.length;t++){if(u.comparisons[t].downloadValue>e){e=u.comparisons[t].downloadValue}if(u.comparisons[t].uploadValue>e){e=u.comparisons[t].uploadValue}}}if(u.vm.downloadSpeed>e){e=u.vm.downloadSpeed}if(u.vm.uploadSpeed>e){e=u.vm.uploadSpeed}return e};var l=function(){u.vm.downloadSpeed=0;i.resetDownload()};var c=function(){u.vm.uploadSpeed=0;i.resetUpload()};var h=function(e,t){var n=0;for(var r=0;r<e.length;r++){if(!t){n+=e[r]}else{n+=e[r][t]}}return n/e.length};u.isOnAir=function(){return u.vm.testActive||u.vm.pingActive||u.vm.downloadActive||u.vm.uploadActive};var p=function(e,t,n){if(!n){n=[]}r.ping().then(function(r){u.vm.pingIteration++;u.vm.pingInstantTime=r;n.push(r);if(t==1){e.resolve(h(n).toFixed(2))}else{p(e,t-1,n)}},function(t){u.vm.pingIteration++;e.reject(t)})};var d=function(e,t,n){if(!n){n=[]}r.download().then(function(r){u.vm.downloadIteration++;u.vm.downloadInstantSpeed=r.speed;n.push(r);if(t==1){e.resolve({time:h(n,"time"),size:h(n,"payloadSize"),speed:h(n,"speed")})}else{d(e,t-1,n)}},function(t){u.vm.downloadIteration++;e.reject(t)})};var v=function(e,t,n){if(!n){n=[]}r.upload(f).then(function(r){u.vm.uploadIteration++;u.vm.uploadInstantSpeed=r.speed;n.push(r);if(t==1){e.resolve({time:h(n,"time"),size:h(n,"payloadSize"),speed:h(n,"speed")})}else{v(e,t-1,n)}},function(t){u.vm.uploadIteration++;e.reject(t)})};u.ping=function(t){u.vm.pingActive=true;u.vm.pingIteration=0;var n=e.defer();p(n,u.iterations);n.promise.then(function(e){u.vm.pingActive=false;u.vm.pingTime=e;if(u.showDownload&&t){u.download(t)}else if(u.showUpload&&t){u.upload()}},function(e){u.vm.pingActive=false;u.vm.pingTime=0})};u.download=function(t){u.vm.downloadActive=true;u.vm.downloadIteration=0;l();var n=e.defer();d(n,u.iterations);n.promise.then(function(e){u.vm.downloadActive=false;u.vm.downloadSpeed=e.speed;i.refreshDownload();if(u.showUpload&&t){u.upload()}},function(e){u.vm.downloadActive=false;u.vm.downloadSpeed=0;i.resetDownload()})};u.upload=function(){u.vm.uploadActive=true;u.vm.uploadIteration=0;c();var t=e.defer();v(t,u.iterations);t.promise.then(function(e){u.vm.uploadActive=false;u.vm.uploadSpeed=e.speed;i.refreshUpload()},function(e){u.vm.uploadActive=false;u.vm.uploadSpeed=0;i.resetUpload()})};u.go=function(){u.vm.testActive=true;l();c();if(u.showPing){u.ping(true)}else if(u.showDownload){u.download(true)}else if(u.showUpload){u.upload()}u.vm.testActive=false};if(u.autoTrigger){var m=t(function(){u.go();t.cancel(m)},20)}var m=t(function(){a();t.cancel(m)},10)}]}}])})()